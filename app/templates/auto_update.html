<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Update - Crypto Report Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auto_upload.css') }}">
</head>
<body class="antialiased min-h-screen" style="background: linear-gradient(180deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);">

    <!-- Success Overlay -->
    <div id="success-overlay" class="loading-overlay" style="display: none;">
        <div class="success-content">
            <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
            <p id="success-message" class="text-lg font-semibold mb-4">Báo cáo đã được tạo thành công!</p>
            <button onclick="closeSuccessOverlay()" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                <i class="fas fa-check mr-2"></i>Đóng
            </button>
        </div>
    </div>

    <!-- Error Overlay -->
    <div id="error-overlay" class="loading-overlay" style="display: none;">
        <div class="error-content">
            <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
            <p id="error-message" class="text-lg font-semibold mb-4">Đã xảy ra lỗi!</p>
            <button onclick="closeErrorOverlay()" class="px-6 py-3 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors">
                <i class="fas fa-times mr-2"></i>Đóng
            </button>
        </div>
    </div>

    {% include 'components/theme_toggle.html' %}

    <div class="auto-update-container">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2" style="color: var(--text-primary);">
                <i class="fas fa-shield-alt mr-3" style="color: var(--accent-color);"></i>
                Auto Update System
            </h1>
            <p style="color: var(--text-secondary);" class="text-lg">
                Hệ thống tự động tạo báo cáo nghiên cứu thị trường crypto
            </p>
            <div class="mt-3 inline-flex items-center px-3 py-1 rounded-full text-sm" style="background-color: rgba(34, 197, 94, 0.1); color: var(--positive-color);">
                <i class="fas fa-lock mr-2"></i>
                Phiên truy cập an toàn
            </div>
        </div>

        <!-- Status Card -->
        <div class="status-card">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold" style="color: var(--text-primary);">
                    <i class="fas fa-info-circle mr-2" style="color: var(--accent-color);"></i>
                    Trạng Thái Hệ Thống
                </h2>
                <button onclick="refreshStatus()" class="px-3 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                    <i class="fas fa-sync-alt mr-1"></i>Làm mới
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p class="text-sm font-medium mb-2" style="color: var(--text-secondary);">Scheduler Status:</p>
                    <div id="scheduler-status" class="status-indicator status-inactive">
                        <i class="fas fa-circle mr-2"></i>Đang tải...
                    </div>
                </div>
                <div>
                    <p class="text-sm font-medium mb-2" style="color: var(--text-secondary);">Khoảng thời gian:</p>
                    <span id="interval-info" class="text-sm font-mono" style="color: var(--text-primary);">--</span>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div class="p-3 rounded-lg" style="background: var(--bg-secondary);">
                    <p class="text-sm font-medium mb-1" style="color: var(--text-secondary);">API Key Status:</p>
                    <span id="api-key-status" class="text-sm font-mono" style="color: var(--text-primary);">Đang kiểm tra...</span>
                </div>
                <div class="p-3 rounded-lg" style="background: var(--bg-secondary);">
                    <p class="text-sm font-medium mb-1" style="color: var(--text-secondary);">Tổng báo cáo:</p>
                    <span id="total-reports" class="text-sm font-mono" style="color: var(--text-primary);">--</span>
                </div>
            </div>
            
            <div class="mt-4 p-3 rounded-lg" style="background: var(--bg-secondary);">
                <p class="text-sm font-medium mb-1" style="color: var(--text-secondary);">Báo cáo cuối cùng:</p>
                <span id="latest-report-time" class="text-sm font-mono" style="color: var(--text-primary);">Chưa có báo cáo</span>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="status-card">
            <h2 class="text-xl font-bold mb-4" style="color: var(--text-primary);">
                <i class="fas fa-cogs mr-2" style="color: var(--accent-color);"></i>
                Điều Khiển
            </h2>
            
            <div class="control-panel">
                <button id="trigger-report-btn" onclick="triggerManualReport()" 
                        class="flex items-center justify-center px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:from-green-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-play mr-2"></i>
                    Tạo Báo Cáo Ngay
                </button>
                
                <button onclick="viewLatestReport()" 
                        class="flex items-center justify-center px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-eye mr-2"></i>
                    Xem Báo Cáo Mới Nhất
                </button>
            </div>
        </div>

        <!-- Progress Status Card -->
        <div id="progress-card" class="status-card" style="display: none;">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold" style="color: var(--text-primary);">
                    <i class="fas fa-chart-line mr-2" style="color: var(--accent-color);"></i>
                    Tiến Độ Tạo Báo Cáo
                </h2>
                <div id="progress-session-id" class="text-xs font-mono px-2 py-1 rounded" style="background: var(--bg-secondary); color: var(--text-secondary);">
                    Session: --
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span id="progress-step-name" class="text-sm font-medium" style="color: var(--text-primary);">Đang khởi tạo...</span>
                    <span id="progress-percentage" class="text-sm font-bold" style="color: var(--accent-color);">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden" style="background: var(--bg-secondary);">
                    <div id="progress-bar" class="h-3 bg-gradient-to-r from-blue-500 to-green-500 transition-all duration-500 ease-out" style="width: 0%;">
                        <div class="h-full bg-white opacity-20 animate-pulse"></div>
                    </div>
                </div>
            </div>
            
            <!-- Progress Details -->
            <div id="progress-details" class="text-sm p-3 rounded-lg" style="background: var(--bg-secondary); color: var(--text-secondary);">
                <i class="fas fa-info-circle mr-2"></i>
                <span id="progress-details-text">Chuẩn bị bắt đầu quy trình tạo báo cáo...</span>
            </div>
            
            <!-- Progress Steps Table -->
            <div class="mt-4">
                <h3 class="text-lg font-semibold mb-3" style="color: var(--text-primary);">
                    <i class="fas fa-list-ol mr-2"></i>
                    Các Bước Thực Hiện
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr style="background: var(--bg-secondary);">
                                <th class="px-3 py-2 text-left" style="color: var(--text-secondary);">Bước</th>
                                <th class="px-3 py-2 text-left" style="color: var(--text-secondary);">Tên Công Việc</th>
                                <th class="px-3 py-2 text-center" style="color: var(--text-secondary);">Trạng Thái</th>
                                <th class="px-3 py-2 text-center" style="color: var(--text-secondary);">Thời Gian</th>
                            </tr>
                        </thead>
                        <tbody id="progress-steps-table">
                            <tr class="border-b" style="border-color: var(--border-color);">
                                <td class="px-3 py-2 font-mono">1</td>
                                <td class="px-3 py-2">Chuẩn bị dữ liệu và khởi tạo AI</td>
                                <td class="px-3 py-2 text-center">
                                    <span class="step-status pending">
                                        <i class="fas fa-clock text-gray-400"></i>
                                    </span>
                                </td>
                                <td class="px-3 py-2 text-center text-xs font-mono">--:--</td>
                            </tr>
                            <tr class="border-b" style="border-color: var(--border-color);">
                                <td class="px-3 py-2 font-mono">2</td>
                                <td class="px-3 py-2">Thu thập dữ liệu từ internet</td>
                                <td class="px-3 py-2 text-center">
                                    <span class="step-status pending">
                                        <i class="fas fa-clock text-gray-400"></i>
                                    </span>
                                </td>
                                <td class="px-3 py-2 text-center text-xs font-mono">--:--</td>
                            </tr>
                            <tr class="border-b" style="border-color: var(--border-color);">
                                <td class="px-3 py-2 font-mono">3</td>
                                <td class="px-3 py-2">Xác thực dữ liệu với hệ thống thời gian thực</td>
                                <td class="px-3 py-2 text-center">
                                    <span class="step-status pending">
                                        <i class="fas fa-clock text-gray-400"></i>
                                    </span>
                                </td>
                                <td class="px-3 py-2 text-center text-xs font-mono">--:--</td>
                            </tr>
                            <tr class="border-b" style="border-color: var(--border-color);">
                                <td class="px-3 py-2 font-mono">4</td>
                                <td class="px-3 py-2">Tạo giao diện báo cáo</td>
                                <td class="px-3 py-2 text-center">
                                    <span class="step-status pending">
                                        <i class="fas fa-clock text-gray-400"></i>
                                    </span>
                                </td>
                                <td class="px-3 py-2 text-center text-xs font-mono">--:--</td>
                            </tr>
                            <tr class="border-b" style="border-color: var(--border-color);">
                                <td class="px-3 py-2 font-mono">5</td>
                                <td class="px-3 py-2">Trích xuất mã nguồn</td>
                                <td class="px-3 py-2 text-center">
                                    <span class="step-status pending">
                                        <i class="fas fa-clock text-gray-400"></i>
                                    </span>
                                </td>
                                <td class="px-3 py-2 text-center text-xs font-mono">--:--</td>
                            </tr>
                            <tr class="border-b" style="border-color: var(--border-color);">
                                <td class="px-3 py-2 font-mono">6</td>
                                <td class="px-3 py-2">Lưu báo cáo vào database</td>
                                <td class="px-3 py-2 text-center">
                                    <span class="step-status pending">
                                        <i class="fas fa-clock text-gray-400"></i>
                                    </span>
                                </td>
                                <td class="px-3 py-2 text-center text-xs font-mono">--:--</td>
                            </tr>
                            <tr>
                                <td class="px-3 py-2 font-mono">7</td>
                                <td class="px-3 py-2">Hoàn thành</td>
                                <td class="px-3 py-2 text-center">
                                    <span class="step-status pending">
                                        <i class="fas fa-clock text-gray-400"></i>
                                    </span>
                                </td>
                                <td class="px-3 py-2 text-center text-xs font-mono">--:--</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Progress Control -->
            <div class="mt-4 flex justify-end">
                <button onclick="cancelProgress()" class="px-4 py-2 text-sm bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                    <i class="fas fa-stop mr-2"></i>Dừng Quá Trình
                </button>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="status-card">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold" style="color: var(--text-primary);">
                    <i class="fas fa-list-alt mr-2" style="color: var(--accent-color);"></i>
                    Nhật Ký Hoạt Động
                </h2>
                <button onclick="clearLog()" class="px-3 py-1 text-sm bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">
                    <i class="fas fa-trash mr-1"></i>Xóa log
                </button>
            </div>
            
            <div id="activity-log" class="log-container">
                <div class="log-entry log-info">
                    <span class="log-timestamp">[Hệ thống]</span> Đang tải thông tin...
                </div>
            </div>
        </div>

        <!-- Configuration Info -->
        <div class="status-card">
            <h2 class="text-xl font-bold mb-4" style="color: var(--text-primary);">
                <i class="fas fa-info-circle mr-2" style="color: var(--accent-color);"></i>
                Thông Tin Cấu Hình
            </h2>
            
            <div class="text-sm space-y-2" style="color: var(--text-secondary);">
                <p><strong>Bảo mật:</strong> Trang này yêu cầu secret key để truy cập</p>
                <p><strong>URL format:</strong> /auto-update-system-&lt;secret_key&gt;</p>
                <p><strong>Tính năng:</strong> Tạo báo cáo nghiên cứu thị trường crypto tự động</p>
                <p><strong>Dữ liệu:</strong> Lấy từ TradingView, CoinMarketCap và các nguồn uy tín</p>
                <p><strong>AI Model:</strong> Google Gemini 2.5 Pro</p>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/theme-manager.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/auto_update.js') }}" defer></script>
</body>
</html>
