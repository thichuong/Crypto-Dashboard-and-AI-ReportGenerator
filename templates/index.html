<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân Tích Thị Trường Crypto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
        }
        .card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .highlight-rsi {
            background-color: #f0fdf4;
            border-left: 4px solid #22c55e;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0.5rem;
        }
        h1, h2, h3 {
            color: #111827;
            font-weight: 800;
        }
        h2 {
            font-size: 1.75rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.75rem;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        h2 .icon {
            color: #4b5563;
            margin-right: 0.75rem;
        }
        table {
            width: 100%;
            margin-top: 1.5rem;
            border-collapse: collapse;
        }
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background-color: #f9fafb;
            color: #1f2937;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }
        tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }
        tbody tr:hover {
            background-color: #f0f9ff;
        }
        .bull-card {
            background-color: #f0fdf4;
            border-left: 4px solid #22c55e;
        }
        .bear-card {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-green-500">Toàn Cảnh Thị Trường Tiền Mã Hóa</h1>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">Phân tích Kỷ nguyên Vốn hóa 4 Nghìn Tỷ USD và Sự Dịch chuyển Dòng vốn Chiến lược</p>
        </header>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <div class="card">
                <div class="flex items-center mb-2">
                    <i class="fab fa-bitcoin text-yellow-500 text-3xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-700">Giá BTC</h3>
                </div>
                <p id="btc-price" class="text-3xl font-bold text-gray-900">Loading...</p>
                <p id="btc-change" class="text-sm">Loading...</p>
            </div>
            <div class="card">
                <div class="flex items-center mb-2">
                    <i class="fas fa-globe-americas text-blue-500 text-3xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-700">Tổng Vốn Hóa</h3>
                </div>
                <p id="market-cap" class="text-3xl font-bold text-gray-900">Loading...</p>
                 <p class="text-sm text-gray-500">Toàn thị trường</p>
            </div>
            <div class="card">
                <div class="flex items-center mb-2">
                    <i class="fas fa-chart-line text-green-500 text-3xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-700">Khối Lượng Giao Dịch 24h</h3>
                </div>
                <p id="volume-24h" class="text-3xl font-bold text-gray-900">Loading...</p>
                 <p class="text-sm text-gray-500">Toàn thị trường</p>
            </div>
            <div class="card">
                <div class="flex items-center mb-2">
                    <i class="fas fa-gauge-high text-red-500 text-3xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-700">Sợ hãi & Tham lam</h3>
                </div>
                <p id="fear-greed-value" class="text-3xl font-bold text-gray-900">Loading...</p>
                <p id="fear-greed-text" class="text-sm font-medium">Loading...</p>
            </div>
        </div>

        <main class="bg-white p-6 md:p-8 rounded-lg border border-gray-200 shadow-lg">
            {{ report_content|safe }}
        </main>
    </div>

    <script>
        const formatNumber = (num) => {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        };

        async function fetchCryptoData() {
            try {
                const [globalRes, btcRes] = await Promise.all([
                    fetch('https://api.coingecko.com/api/v3/global'),
                    fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true')
                ]);
                if (!globalRes.ok || !btcRes.ok) throw new Error('Network response was not ok.');
                
                const globalData = await globalRes.json();
                const btcData = await btcRes.json();

                const marketData = globalData.data;
                const bitcoin = btcData.bitcoin;

                document.getElementById('market-cap').textContent = '$' + formatNumber(marketData.total_market_cap.usd);
                document.getElementById('volume-24h').textContent = '$' + formatNumber(marketData.total_volume.usd);
                document.getElementById('btc-price').textContent = '$' + bitcoin.usd.toLocaleString('en-US');
                
                const btcChangeEl = document.getElementById('btc-change');
                const change = bitcoin.usd_24h_change;
                btcChangeEl.textContent = `${change.toFixed(2)}% (24h)`;
                btcChangeEl.className = `text-sm font-semibold ${change >= 0 ? 'text-green-600' : 'text-red-600'}`;

            } catch (error) {
                console.error('Failed to fetch crypto data:', error);
                ['market-cap', 'volume-24h', 'btc-price'].forEach(id => document.getElementById(id).textContent = 'Error');
            }
        }

        async function fetchFearAndGreed() {
            try {
                const response = await fetch('https://api.alternative.me/fng/?limit=1');
                if (!response.ok) throw new Error('Network response was not ok for F&G data.');
                const data = await response.json();
                const fearGreed = data.data[0];

                const valueEl = document.getElementById('fear-greed-value');
                const textEl = document.getElementById('fear-greed-text');

                valueEl.textContent = fearGreed.value;
                textEl.textContent = fearGreed.value_classification;

                let colorClass = 'text-yellow-500';
                if (parseInt(fearGreed.value) <= 25) colorClass = 'text-red-600';
                if (parseInt(fearGreed.value) >= 75) colorClass = 'text-green-600';
                textEl.className = `text-sm font-medium ${colorClass}`;

            } catch (error) {
                console.error('Failed to fetch Fear and Greed Index:', error);
                document.getElementById('fear-greed-value').textContent = 'Error';
            }
        }

        function init() {
            fetchCryptoData();
            fetchFearAndGreed();
            setInterval(fetchCryptoData, 60000);
            setInterval(fetchFearAndGreed, 300000); // F&G updates less frequently
        }

        window.onload = init;
    </script>
</body>
</html>